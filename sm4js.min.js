!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).Sm4js=r()}(this,function(){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}var e;e="object"==("undefined"==typeof window?"undefined":r(window))?window.base64js:require("base64-js");var o=function(){function r(t){i(this,r)}return t(r,[{key:"zero",value:function(t){var r;if(0<t){r="0";for(var e=1;e<t;e++)r+=r;return r}return""}},{key:"stringToArray",value:function(t){for(var r=[],e=t.length,n=0;n<e;n++){var i=t.charCodeAt(n);if(19968<i&&i<40869){var o=i.toString(2),s="1110",a="10",y="10",u=o.length;u<=6?(y=y+this.zero(6-u)+o,a+=this.zero(6),s+=this.zero(4)):6<u&&u<=12?(y+=o.slice(-6),a=a+this.zero(12-u)+o.substr(0,u-6),s+=this.zero(4)):(y+=o.slice(-6),a+=o.substr(u-12,6),s=s+this.zero(16-u)+o.substr(0,u-12)),r.push(parseInt(s,2),parseInt(a,2),parseInt(y,2))}else r.push(i)}return r}},{key:"stringToArrayBufferInUtf8",value:function(t){return this.stringToArray(t)}},{key:"utf8ArrayBufferToString",value:function(t){for(var r="",e=t.length,n=0;n<e;){var i,o=parseInt(t[n]).toString(2);if(1==o.substr(0,1)&&8==o.length){var s=parseInt(t[n]).toString(2).substr(4),a=parseInt(t[n+1]).toString(2).substr(2),y=parseInt(t[n+2]).toString(2).substr(2),u=parseInt(s+a+y,2);i=String.fromCharCode(u),n+=3}else i=String.fromCharCode(parseInt(o,2)),n++;r+=i}return r}},{key:"arrayBufferToBase64",value:function(t){return e.fromByteArray(t)}},{key:"base64ToArrayBuffer",value:function(t){return e.toByteArray(t)}}]),r}();Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(t,r,e){if(null==this)throw new TypeError("this is null or not defined");for(var n=Object(this),i=n.length>>>0,o=r>>0,s=o<0?Math.max(i+o,0):Math.min(o,i),a=void 0===e?i:e>>0,y=a<0?Math.max(i+a,0):Math.min(a,i);s<y;)n[s]=t,s++;return n}});var l=16,s=new Uint8Array([214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72]);Uint8Array.prototype.fill=function(){Array.prototype.fill.apply(this,arguments)},Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(t){return new Uint8Array(this).subarray(t)});var a=new Uint32Array([462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257]),y=new Uint32Array([2746333894,1453994832,1736282519,2993693404]);return function(){function n(t){i(this,n),this.Crypt=new o;var r=this.Crypt.stringToArrayBufferInUtf8(t.key);if(16!==r.length)throw new Error("key should be a 16 bytes string");this.key=r;var e=new Uint8Array(0);if(void 0!==t.iv&&null!==t.iv&&16!==(e=this.Crypt.stringToArrayBufferInUtf8(t.iv)).length)throw new Error("iv should be a 16 bytes string");this.iv=e,0<=[this.mode="cbc","ecb"].indexOf(t.mode)&&(this.mode=t.mode),0<=[this.cipherType="base64","text"].indexOf(t.outType)&&(this.cipherType=t.outType),this.encryptRoundKeys=new Uint32Array(32),this.spawnEncryptRoundKeys(),Uint32Array.prototype.reverse=function(){Array.prototype.reverse.apply(this,arguments)},this.decryptRoundKeys=new Uint32Array(this.encryptRoundKeys),this.decryptRoundKeys.reverse()}return t(n,[{key:"doBlockCrypt",value:function(t,r){var e=new Uint32Array(36);e.set(t,0);for(var n=0;n<32;n++)e[n+4]=e[n]^this.tTransform1(e[n+1]^e[n+2]^e[n+3]^r[n]);var i=new Uint32Array(4);return i[0]=e[35],i[1]=e[34],i[2]=e[33],i[3]=e[32],i}},{key:"spawnEncryptRoundKeys",value:function(){var t=new Uint32Array(4);t[0]=this.key[0]<<24|this.key[1]<<16|this.key[2]<<8|this.key[3],t[1]=this.key[4]<<24|this.key[5]<<16|this.key[6]<<8|this.key[7],t[2]=this.key[8]<<24|this.key[9]<<16|this.key[10]<<8|this.key[11],t[3]=this.key[12]<<24|this.key[13]<<16|this.key[14]<<8|this.key[15];var r=new Uint32Array(36);r[0]=t[0]^y[0],r[1]=t[1]^y[1],r[2]=t[2]^y[2],r[3]=t[3]^y[3];for(var e=0;e<32;e++)r[e+4]=r[e]^this.tTransform2(r[e+1]^r[e+2]^r[e+3]^a[e]),this.encryptRoundKeys[e]=r[e+4]}},{key:"rotateLeft",value:function(t,r){return t<<r|t>>>32-r}},{key:"linearTransform1",value:function(t){return t^this.rotateLeft(t,2)^this.rotateLeft(t,10)^this.rotateLeft(t,18)^this.rotateLeft(t,24)}},{key:"linearTransform2",value:function(t){return t^this.rotateLeft(t,13)^this.rotateLeft(t,23)}},{key:"tauTransform",value:function(t){return s[t>>>24&255]<<24|s[t>>>16&255]<<16|s[t>>>8&255]<<8|s[255&t]}},{key:"tTransform1",value:function(t){var r=this.tauTransform(t);return this.linearTransform1(r)}},{key:"tTransform2",value:function(t){var r=this.tauTransform(t);return this.linearTransform2(r)}},{key:"padding",value:function(t){if(null===t)return null;var r=l-t.length%l,e=new Uint8Array(t.length+r);return e.set(t,0),e.fill(r,t.length),e}},{key:"dePadding",value:function(t){if(null===t)return null;var r=t[t.length-1];return t.slice(0,t.length-r)}},{key:"uint8ToUint32Block",value:function(t,r){void 0===r&&(r=0);var e=new Uint32Array(4);return e[0]=t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3],e[1]=t[r+4]<<24|t[r+5]<<16|t[r+6]<<8|t[r+7],e[2]=t[r+8]<<24|t[r+9]<<16|t[r+10]<<8|t[r+11],e[3]=t[r+12]<<24|t[r+13]<<16|t[r+14]<<8|t[r+15],e}},{key:"encrypt",value:function(t){var r=this.Crypt.stringToArrayBufferInUtf8(t),e=this.padding(r),n=e.length/l,i=new Uint8Array(e.length);if("cbc"===this.mode){if(null===this.iv||16!==this.iv.length)throw new Error("iv error");for(var o=this.uint8ToUint32Block(this.iv),s=0;s<n;s++){var a=s*l,y=this.uint8ToUint32Block(e,a);o[0]=o[0]^y[0],o[1]=o[1]^y[1],o[2]=o[2]^y[2],o[3]=o[3]^y[3],o=f=this.doBlockCrypt(o,this.encryptRoundKeys);for(var u=0;u<l;u++)i[a+u]=f[parseInt(u/4)]>>(3-u)%4*8&255}}else for(s=0;s<n;s++){a=s*l,y=this.uint8ToUint32Block(e,a);var f=this.doBlockCrypt(y,this.encryptRoundKeys);for(u=0;u<l;u++)i[a+u]=f[parseInt(u/4)]>>(3-u)%4*8&255}return"base64"===this.cipherType?this.Crypt.arrayBufferToBase64(i):this.Crypt.utf8ArrayBufferToString(i)}},{key:"decrypt",value:function(t){var r=new Uint8Array,e=(r="base64"===this.cipherType?this.Crypt.base64ToArrayBuffer(t):this.Crypt.stringToArrayBufferInUtf8(t)).length/l,n=new Uint8Array(r.length);if("cbc"===this.mode){if(null===this.iv||16!==this.iv.length)throw new Error("iv error");for(var i=this.uint8ToUint32Block(this.iv),o=0;o<e;o++){var s=o*l,a=this.uint8ToUint32Block(r,s),y=this.doBlockCrypt(a,this.decryptRoundKeys);(f=new Uint32Array(4))[0]=i[0]^y[0],f[1]=i[1]^y[1],f[2]=i[2]^y[2],f[3]=i[3]^y[3],i=a;for(var u=0;u<l;u++)n[s+u]=f[parseInt(u/4)]>>(3-u)%4*8&255}}else for(o=0;o<e;o++){s=o*l,a=this.uint8ToUint32Block(r,s);var f=this.doBlockCrypt(a,this.decryptRoundKeys);for(u=0;u<l;u++)n[s+u]=f[parseInt(u/4)]>>(3-u)%4*8&255}var h=this.dePadding(n);return this.Crypt.utf8ArrayBufferToString(h)}}]),n}()});
